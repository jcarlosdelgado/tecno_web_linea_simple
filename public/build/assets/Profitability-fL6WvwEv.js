import{r as h,c as f,a as l,b as p,u as T,h as S,w as u,d as e,t as a,q as w,i as c,e as x,o as d,F as k,f as M}from"./app-BlCBzDlk.js";import{_ as R}from"./AuthenticatedLayout-DQ_849qa.js";import{_ as y}from"./Card-O9o5eUXT.js";import{_ as C}from"./Badge-DUws-gGn.js";import"./Footer-o2Y0PLgd.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ResponsiveNavLink-BzKXVlKb.js";const A={class:"flex items-center justify-between"},E={class:"flex gap-3"},G=["href"],I=["href"],L={class:"py-12"},O={class:"max-w-7xl mx-auto sm:px-6 lg:px-8 space-y-6"},q={class:"grid grid-cols-1 md:grid-cols-4 gap-6"},z={class:"text-2xl font-bold text-gray-900 mt-2"},U={class:"text-2xl font-bold text-gray-900 mt-2"},H={class:"text-2xl font-bold text-gray-900 mt-2"},Z={class:"overflow-x-auto"},J={class:"min-w-full divide-y divide-gray-200"},K={class:"bg-gray-50"},Q={key:0},W={key:0},X={key:0},Y={key:0},tt={key:0},et={key:0},st={class:"bg-white divide-y divide-gray-200"},rt={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},at={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-600"},ot={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right"},nt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right"},it={class:"px-6 py-4 whitespace-nowrap text-right"},lt={class:"px-6 py-4 whitespace-nowrap text-center"},dt={key:0,class:"text-center py-12 text-gray-500"},yt={__name:"Profitability",props:{profitability:Array,startDate:String,endDate:String},setup(v){const o=v,n=h("profit"),i=h("desc"),D=f(()=>[...o.profitability].sort((t,s)=>{const N=t[n.value],P=s[n.value],b=i.value==="asc"?1:-1;return N>P?b:-b})),g=r=>{n.value===r?i.value=i.value==="asc"?"desc":"asc":(n.value=r,i.value="desc")},m=r=>new Intl.NumberFormat("es-BO",{style:"currency",currency:"BOB",minimumFractionDigits:2}).format(r),$=()=>{let r=route("admin.reportes.rentabilidad.pdf");const t=new URLSearchParams;o.startDate&&t.append("start_date",o.startDate),o.endDate&&t.append("end_date",o.endDate);const s=t.toString();return s?`${r}?${s}`:r},j=r=>r>=30?"success":r>=15?"warning":"danger",V=f(()=>o.profitability.reduce((r,t)=>r+t.revenue,0)),F=f(()=>o.profitability.reduce((r,t)=>r+t.expenses,0)),_=f(()=>o.profitability.reduce((r,t)=>r+t.profit,0)),B=f(()=>{const r=o.profitability.reduce((t,s)=>t+s.margin_percentage,0);return o.profitability.length>0?r/o.profitability.length:0});return(r,t)=>(d(),l(k,null,[p(T(S),{title:"Rentabilidad por Trabajo"}),p(R,null,{header:u(()=>[e("div",A,[t[7]||(t[7]=e("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"}," Análisis de Rentabilidad ",-1)),e("div",E,[e("a",{href:$(),target:"_blank",class:"inline-flex items-center px-4 py-2 bg-red-600 text-white text-sm font-medium rounded-lg hover:bg-red-700 transition-colors"},[...t[6]||(t[6]=[e("svg",{class:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),x(" Exportar PDF ",-1)])],8,G),e("a",{href:r.route("admin.reportes.dashboard"),class:"text-sm text-indigo-600 hover:text-indigo-800"}," ← Volver al Dashboard ",8,I)])])]),default:u(()=>[e("div",L,[e("div",O,[e("div",q,[p(y,null,{default:u(()=>[t[8]||(t[8]=e("p",{class:"text-sm font-medium text-gray-600"},"Ingresos Totales",-1)),e("p",z,a(m(V.value)),1)]),_:1}),p(y,null,{default:u(()=>[t[9]||(t[9]=e("p",{class:"text-sm font-medium text-gray-600"},"Gastos Totales",-1)),e("p",U,a(m(F.value)),1)]),_:1}),p(y,null,{default:u(()=>[t[10]||(t[10]=e("p",{class:"text-sm font-medium text-gray-600"},"Ganancia Total",-1)),e("p",{class:w(["text-2xl font-bold mt-2",_.value>=0?"text-green-600":"text-red-600"])},a(m(_.value)),3)]),_:1}),p(y,null,{default:u(()=>[t[11]||(t[11]=e("p",{class:"text-sm font-medium text-gray-600"},"Margen Promedio",-1)),e("p",H,a(B.value.toFixed(1))+"%",1)]),_:1})]),p(y,{title:"Rentabilidad por Trabajo"},{default:u(()=>[e("div",Z,[e("table",J,[e("thead",K,[e("tr",null,[e("th",{onClick:t[0]||(t[0]=s=>g("client")),class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100"},[t[12]||(t[12]=x(" Cliente ",-1)),n.value==="client"?(d(),l("span",Q,a(i.value==="asc"?"↑":"↓"),1)):c("",!0)]),e("th",{onClick:t[1]||(t[1]=s=>g("job_title")),class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100"},[t[13]||(t[13]=x(" Trabajo ",-1)),n.value==="job_title"?(d(),l("span",W,a(i.value==="asc"?"↑":"↓"),1)):c("",!0)]),e("th",{onClick:t[2]||(t[2]=s=>g("revenue")),class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100"},[t[14]||(t[14]=x(" Presupuesto ",-1)),n.value==="revenue"?(d(),l("span",X,a(i.value==="asc"?"↑":"↓"),1)):c("",!0)]),e("th",{onClick:t[3]||(t[3]=s=>g("expenses")),class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100"},[t[15]||(t[15]=x(" Gastos ",-1)),n.value==="expenses"?(d(),l("span",Y,a(i.value==="asc"?"↑":"↓"),1)):c("",!0)]),e("th",{onClick:t[4]||(t[4]=s=>g("profit")),class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100"},[t[16]||(t[16]=x(" Ganancia ",-1)),n.value==="profit"?(d(),l("span",tt,a(i.value==="asc"?"↑":"↓"),1)):c("",!0)]),e("th",{onClick:t[5]||(t[5]=s=>g("margin_percentage")),class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100"},[t[17]||(t[17]=x(" Margen ",-1)),n.value==="margin_percentage"?(d(),l("span",et,a(i.value==="asc"?"↑":"↓"),1)):c("",!0)]),t[18]||(t[18]=e("th",{class:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider"}," Estado ",-1))])]),e("tbody",st,[(d(!0),l(k,null,M(D.value,s=>(d(),l("tr",{key:s.job_id,class:"hover:bg-gray-50"},[e("td",rt,a(s.client),1),e("td",at,a(s.job_title),1),e("td",ot,a(m(s.revenue)),1),e("td",nt,a(m(s.expenses)),1),e("td",{class:w(["px-6 py-4 whitespace-nowrap text-sm font-medium text-right",s.profit>=0?"text-green-600":"text-red-600"])},a(m(s.profit)),3),e("td",it,[p(C,{variant:j(s.margin_percentage)},{default:u(()=>[x(a(s.margin_percentage.toFixed(1))+"% ",1)]),_:2},1032,["variant"])]),e("td",lt,[p(C,{variant:s.status==="FINALIZADO"?"success":"default"},{default:u(()=>[x(a(s.status.replace("_"," ")),1)]),_:2},1032,["variant"])])]))),128))])]),v.profitability.length===0?(d(),l("div",dt," No hay datos de rentabilidad para mostrar ")):c("",!0)])]),_:1})])])]),_:1})],64))}};export{yt as default};
