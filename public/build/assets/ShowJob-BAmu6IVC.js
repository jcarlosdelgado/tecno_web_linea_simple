import{m as O,c as y,r as z,B as I,a as u,b as r,u as g,h as V,w as o,d as t,i as c,o as n,e as d,t as l,g as x,F as j,f as D,l as _}from"./app-BlCBzDlk.js";import{_ as N}from"./AuthenticatedLayout-DQ_849qa.js";import{_ as b}from"./Card-O9o5eUXT.js";import{_ as f}from"./Button-CX2Fugjk.js";import{_ as R}from"./Badge-DUws-gGn.js";import{_ as v}from"./Alert-0xs92er9.js";import{P as L,a as M}from"./PhotoGallery-C50wINW0.js";import"./Footer-o2Y0PLgd.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ResponsiveNavLink-BzKXVlKb.js";const U={class:"flex items-center justify-between"},$={class:"flex items-center space-x-4"},F={class:"py-12"},H={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},q={key:0,class:"bg-white p-4 rounded-lg shadow-sm border border-gray-200 mb-6"},Z={key:1,class:"mb-6"},G={class:"bg-gray-100 p-4 mb-4 rounded text-xs font-mono hidden"},J={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},Y={class:"lg:col-span-2 space-y-6"},K={class:"space-y-4"},Q={class:"text-2xl font-bold text-gray-900"},W={class:"text-sm text-gray-500 mt-1"},X={class:"text-gray-900 whitespace-pre-wrap"},tt={key:0},et={class:"space-y-4"},st={key:0},ot={class:"border border-gray-200 rounded-lg overflow-hidden"},at={class:"min-w-full divide-y divide-gray-200"},rt={class:"bg-white divide-y divide-gray-200"},it={class:"px-4 py-3 text-sm text-gray-900"},lt={class:"px-4 py-3 text-sm text-gray-600"},nt={class:"px-4 py-3 text-sm text-gray-600"},dt={class:"px-4 py-3 text-sm text-gray-900 text-right font-medium"},ut={class:"bg-gray-50 rounded-lg p-4 space-y-2"},ct={class:"flex justify-between text-sm"},pt={class:"font-medium"},mt={key:0,class:"flex justify-between text-sm"},ft={class:"font-medium"},gt={class:"flex justify-between pt-2 border-t border-gray-200"},ht={class:"font-bold text-indigo-600 text-2xl"},bt={key:1,class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},vt={class:"text-sm text-blue-800"},xt={class:"flex justify-end"},yt=["href"],_t={class:"flex gap-3 pt-4"},jt={class:"space-y-6"},kt={class:"space-y-6"},wt={class:"absolute -left-[17px] top-0 w-8 h-8 bg-indigo-100 rounded-full flex items-center justify-center text-lg border-2 border-white"},Pt={class:"min-w-0"},Ct={class:"flex justify-between items-start"},Et={class:"text-sm font-bold text-gray-900"},Ot={class:"text-xs text-gray-500"},Dt={class:"text-sm text-gray-600 mt-1"},Mt={key:0,class:"mt-3"},St={key:0,class:"text-center py-4 text-gray-500 text-sm"},At={class:"space-y-3"},Bt={class:"text-sm text-gray-600"},Tt={class:"font-bold text-gray-900"},zt={class:"space-y-3"},It={class:"flex justify-between text-sm"},Vt={class:"font-bold text-indigo-600"},Nt={key:0},Rt=["href"],Lt={class:"space-y-3"},Ut={key:0},$t=["href"],Ft=["href"],te={__name:"ShowJob",props:{trabajo:Object,presupuestos:Array,pagos:Array,seguimientos:Array},setup(a){const m=a,k=O({}),w=O({}),S=i=>{confirm("¬øEst√°s seguro de aprobar este presupuesto? Ser√°s redirigido a realizar el pago para que iniciemos tu trabajo.")&&k.post(route("presupuestos.approve",i))},A=i=>{confirm("¬øEst√°s seguro de rechazar este presupuesto?")&&w.post(route("presupuestos.reject",i))},B=i=>({SOLICITADO:"warning",PRESUPUESTADO:"info",EN_PRODUCCION:"default",FINALIZADO:"success",CANCELADO:"danger"})[i]||"default",p=y(()=>m.trabajo.presupuestos?.find(i=>i.estado==="PENDIENTE")),h=y(()=>m.trabajo.presupuestos?.find(i=>i.estado==="APROBADO")),P=y(()=>!m.trabajo.seguimientos||m.trabajo.seguimientos.length===0?0:m.trabajo.seguimientos[m.trabajo.seguimientos.length-1].porcentaje_avance),C=y(()=>{const i=[];return i.push({type:"solicitud",fecha:m.trabajo.fecha_solicitud,titulo:"Trabajo Solicitado",descripcion:"Has solicitado este trabajo",icon:"üìù"}),m.trabajo.presupuestos&&m.trabajo.presupuestos.forEach(e=>{i.push({type:"presupuesto",fecha:e.fecha_emision,titulo:`Presupuesto ${e.estado}`,descripcion:`Monto: $${e.monto_total}`,icon:"üí∞"})}),m.trabajo.pagos&&m.trabajo.pagos.forEach(e=>{i.push({type:"pago",fecha:e.fecha_pago,titulo:"Pago Realizado",descripcion:`Monto: $${e.monto}`,icon:"üí≥"})}),m.trabajo.seguimientos&&m.trabajo.seguimientos.forEach(e=>{i.push({type:"seguimiento",fecha:e.fecha,titulo:`Avance: ${e.porcentaje_avance}%`,descripcion:e.descripcion,icon:"üîÑ",fotos:e.fotos})}),i.sort((e,s)=>new Date(s.fecha)-new Date(e.fecha))}),E=z(!1);return I(()=>{new URLSearchParams(window.location.search).get("payment_success")==="true"&&(E.value=!0,window.history.replaceState({},document.title,window.location.pathname))}),(i,e)=>(n(),u(j,null,[r(g(V),{title:a.trabajo.titulo},null,8,["title"]),r(N,null,{header:o(()=>[t("div",U,[t("div",$,[r(g(_),{href:i.route("dashboard")},{default:o(()=>[r(f,{variant:"ghost",size:"sm"},{default:o(()=>[...e[2]||(e[2]=[t("svg",{class:"w-5 h-5 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1),d(" Volver ",-1)])]),_:1})]),_:1},8,["href"]),e[3]||(e[3]=t("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"}," Detalles del Trabajo ",-1))]),r(R,{variant:B(a.trabajo.estado),size:"lg",dot:""},{default:o(()=>[d(l(a.trabajo.estado.replace("_"," ")),1)]),_:1},8,["variant"])])]),default:o(()=>[t("div",F,[t("div",H,[a.trabajo.estado==="EN_PRODUCCION"||a.trabajo.estado==="FINALIZADO"?(n(),u("div",q,[r(L,{percentage:P.value,height:"h-6"},null,8,["percentage"])])):c("",!0),E.value?(n(),u("div",Z,[r(v,{type:"success",title:"¬°Pago Realizado con √âxito!"},{default:o(()=>[...e[4]||(e[4]=[d(" Tu pago ha sido procesado correctamente. El estado del trabajo se ha actualizado. ",-1)])]),_:1})])):c("",!0),t("div",G," PRESUPUESTO APROBADO: "+l(h.value?"SI":"NO")+" ESTADO: "+l(a.trabajo.estado)+" PRESUPUESTOS: "+l(a.trabajo.presupuestos),1),t("div",J,[t("div",Y,[r(b,null,{default:o(()=>[t("div",K,[t("div",null,[t("h3",Q,l(a.trabajo.titulo),1),t("p",W," Solicitado el "+l(new Date(a.trabajo.fecha_solicitud).toLocaleDateString("es-ES")),1)]),t("div",null,[e[5]||(e[5]=t("h4",{class:"text-sm font-medium text-gray-700 mb-1"},"Descripci√≥n:",-1)),t("p",X,l(a.trabajo.descripcion),1)]),a.trabajo.imagenes_referencia&&a.trabajo.imagenes_referencia.length>0?(n(),u("div",tt,[e[6]||(e[6]=t("h4",{class:"text-sm font-medium text-gray-700 mb-2"},"Im√°genes de Referencia:",-1)),r(M,{photos:a.trabajo.imagenes_referencia},null,8,["photos"])])):c("",!0)])]),_:1}),p.value?(n(),x(b,{key:0,title:"Presupuesto Recibido"},{default:o(()=>[t("div",et,[r(v,{type:"info",title:"Nuevo Presupuesto"},{default:o(()=>[...e[7]||(e[7]=[d(" Tienes un presupuesto pendiente de revisi√≥n. Por favor revisa los detalles y decide si deseas aprobarlo o rechazarlo. ",-1)])]),_:1}),p.value.detalles&&p.value.detalles.length>0?(n(),u("div",st,[e[9]||(e[9]=t("h5",{class:"text-sm font-medium text-gray-700 mb-3"},"Materiales Incluidos:",-1)),t("div",ot,[t("table",at,[e[8]||(e[8]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase"},"Material"),t("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase"},"Cantidad"),t("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase"},"Precio Unit."),t("th",{class:"px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase"},"Subtotal")])],-1)),t("tbody",rt,[(n(!0),u(j,null,D(p.value.detalles,s=>(n(),u("tr",{key:s.id_detalle},[t("td",it,l(s.material?.nombre),1),t("td",lt,l(s.cantidad)+" "+l(s.material?.unidad_medida),1),t("td",nt,"Bs "+l(s.precio_unitario),1),t("td",dt,"Bs "+l(s.subtotal),1)]))),128))])])])])):c("",!0),t("div",ut,[t("div",ct,[e[10]||(e[10]=t("span",{class:"text-gray-600"},"Mano de obra:",-1)),t("span",pt,"Bs "+l(p.value.mano_obra),1)]),p.value.otros_costos>0?(n(),u("div",mt,[e[11]||(e[11]=t("span",{class:"text-gray-600"},"Otros costos:",-1)),t("span",ft,"Bs "+l(p.value.otros_costos),1)])):c("",!0),t("div",gt,[e[12]||(e[12]=t("span",{class:"font-semibold text-gray-900 text-lg"},"Total:",-1)),t("span",ht,"Bs "+l(p.value.monto_total),1)])]),p.value.notas?(n(),u("div",bt,[e[13]||(e[13]=t("h5",{class:"text-sm font-medium text-blue-900 mb-1"},"Notas del Presupuesto:",-1)),t("p",vt,l(p.value.notas),1)])):c("",!0),t("div",xt,[t("a",{href:i.route("presupuestos.pdf",p.value.id_presupuesto),target:"_blank"},[r(f,{variant:"outline",size:"sm"},{default:o(()=>[...e[14]||(e[14]=[t("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),d(" Descargar Cotizaci√≥n PDF ",-1)])]),_:1})],8,yt)]),t("div",_t,[r(f,{onClick:e[0]||(e[0]=s=>S(p.value.id_presupuesto)),variant:"primary",class:"flex-1",loading:g(k).processing},{default:o(()=>[...e[15]||(e[15]=[t("svg",{class:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1),d(" Aprobar Presupuesto ",-1)])]),_:1},8,["loading"]),r(f,{onClick:e[1]||(e[1]=s=>A(p.value.id_presupuesto)),variant:"danger",class:"flex-1",loading:g(w).processing},{default:o(()=>[...e[16]||(e[16]=[t("svg",{class:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),d(" Rechazar ",-1)])]),_:1},8,["loading"])])])]),_:1})):c("",!0),!p.value&&!h.value&&a.trabajo.estado==="SOLICITADO"?(n(),x(v,{key:1,type:"info",title:"En Espera"},{default:o(()=>[...e[17]||(e[17]=[d(" Tu solicitud ha sido recibida. Pronto recibir√°s un presupuesto detallado. ",-1)])]),_:1})):c("",!0)]),t("div",jt,[r(b,{title:"Historial"},{default:o(()=>[t("div",kt,[(n(!0),u(j,null,D(C.value,(s,T)=>(n(),u("div",{key:T,class:"relative pl-8 pb-6 border-l-2 border-indigo-100 last:pb-0"},[t("div",wt,l(s.icon),1),t("div",Pt,[t("div",Ct,[t("p",Et,l(s.titulo),1),t("span",Ot,l(new Date(s.fecha).toLocaleDateString("es-ES")),1)]),t("p",Dt,l(s.descripcion),1),s.fotos&&s.fotos.length>0?(n(),u("div",Mt,[r(M,{photos:s.fotos},null,8,["photos"])])):c("",!0)])]))),128)),C.value.length===0?(n(),u("div",St," No hay eventos a√∫n ")):c("",!0)])]),_:1}),h.value&&a.trabajo.estado==="PRESUPUESTADO"?(n(),x(b,{key:0,title:"Proceder al Pago"},{default:o(()=>[t("div",At,[r(v,{type:"info",title:"Pago Requerido"},{default:o(()=>[...e[18]||(e[18]=[d(" Para que iniciemos tu trabajo, necesitas realizar el pago primero. ",-1)])]),_:1}),t("p",Bt,[e[19]||(e[19]=d(" Monto a pagar: ",-1)),t("span",Tt,"Bs "+l(h.value.monto_total),1)]),r(g(_),{href:i.route("pagos.select",a.trabajo.id_trabajo)},{default:o(()=>[r(f,{variant:"primary",class:"w-full"},{default:o(()=>[...e[20]||(e[20]=[t("svg",{class:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"})],-1),d(" Pagar Ahora ",-1)])]),_:1})]),_:1},8,["href"])])]),_:1})):c("",!0),a.trabajo.estado==="EN_PRODUCCION"?(n(),x(b,{key:1,title:"Estado del Trabajo"},{default:o(()=>[t("div",zt,[r(v,{type:"success",title:"Trabajo en Producci√≥n"},{default:o(()=>[...e[21]||(e[21]=[d(" ¬°Tu trabajo est√° siendo procesado! Ya realizaste el pago. ",-1)])]),_:1}),t("div",It,[e[22]||(e[22]=t("span",{class:"text-gray-600"},"Progreso actual:",-1)),t("span",Vt,l(P.value)+"%",1)]),a.trabajo.pagos&&a.trabajo.pagos.some(s=>s.tipo_pago==="CREDITO")?(n(),u("div",Nt,[r(g(_),{href:i.route("cuotas.index",a.trabajo.pagos.find(s=>s.tipo_pago==="CREDITO").id_pago),class:"block mt-3"},{default:o(()=>[r(f,{variant:"secondary",class:"w-full",size:"sm"},{default:o(()=>[...e[23]||(e[23]=[t("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})],-1),d(" Ver Plan de Cuotas ",-1)])]),_:1})]),_:1},8,["href"])])):c("",!0),t("a",{href:i.route("presupuestos.pdf",h.value.id_presupuesto),target:"_blank",class:"mt-3"},[r(f,{variant:"outline",class:"w-full",size:"sm"},{default:o(()=>[...e[24]||(e[24]=[t("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),d(" Ver Cotizaci√≥n ",-1)])]),_:1})],8,Rt)])]),_:1})):c("",!0),a.trabajo.estado==="FINALIZADO"&&a.trabajo.pagos&&a.trabajo.pagos.some(s=>s.estado==="COMPLETADO")?(n(),x(b,{key:2,title:"Trabajo Completado"},{default:o(()=>[t("div",Lt,[r(v,{type:"success",title:"¬°Listo!"},{default:o(()=>[...e[25]||(e[25]=[d(" Tu trabajo ha sido completado exitosamente. ",-1)])]),_:1}),a.trabajo.pagos.some(s=>s.tipo_pago==="CREDITO")?(n(),u("div",Ut,[r(g(_),{href:i.route("cuotas.index",a.trabajo.pagos.find(s=>s.tipo_pago==="CREDITO").id_pago),class:"block mb-3"},{default:o(()=>[r(f,{variant:"secondary",class:"w-full",size:"sm"},{default:o(()=>[...e[26]||(e[26]=[t("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})],-1),d(" Ver Plan de Cuotas ",-1)])]),_:1})]),_:1},8,["href"])])):c("",!0),t("a",{href:i.route("pagos.comprobante",a.trabajo.pagos.find(s=>s.estado==="COMPLETADO").id_pago),target:"_blank",class:"mt-3"},[r(f,{variant:"outline",class:"w-full"},{default:o(()=>[...e[27]||(e[27]=[t("svg",{class:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),d(" Descargar Comprobante ",-1)])]),_:1})],8,$t),t("a",{href:i.route("presupuestos.pdf",h.value.id_presupuesto),target:"_blank"},[r(f,{variant:"outline",class:"w-full",size:"sm"},{default:o(()=>[...e[28]||(e[28]=[t("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),d(" Ver Cotizaci√≥n ",-1)])]),_:1})],8,Ft)])]),_:1})):c("",!0)])])])])]),_:1})],64))}};export{te as default};
