import{r as g,B as I,C as j,M as B,p as E,c as p,a as s,b as T,d as t,u as w,h as O,i as c,e as u,t as n,q as k,g as F,w as R,l as V,F as M,o}from"./app-BlCBzDlk.js";import{_ as N}from"./_plugin-vue_export-helper-DlAUqK2U.js";const z={class:"min-h-screen bg-gradient-to-br from-indigo-50 to-purple-50 flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8"},A={class:"max-w-md w-full space-y-8 bg-white p-8 rounded-2xl shadow-2xl"},Q={class:"text-center"},S={class:"mt-2 text-sm text-gray-600"},L={key:0},$={class:"text-indigo-600"},G={key:1},U={class:"text-indigo-600"},H={key:0,class:"mt-1 text-xs text-gray-500"},J={key:0,class:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-lg text-center animate-pulse"},K={key:1,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg text-center"},W={class:"flex justify-center my-8"},X={key:0,class:"w-64 h-64 bg-gray-200 animate-pulse rounded-lg flex items-center justify-center"},Y={key:1,class:"relative group"},Z=["src"],ee={key:0,class:"absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity bg-black bg-opacity-10 rounded-lg"},te={key:2,class:"w-64 h-64 bg-gray-100 rounded-lg flex items-center justify-center"},ae={key:2,class:"text-center"},oe={class:"text-xs text-gray-500 mt-1"},se={key:3,class:"text-center"},re=["href"],ne={class:"mt-8 space-y-4"},le={__name:"Checkout",props:{pago:Object,qrData:Object,auth:Object},setup(a){const i=a,_=()=>{window.history.back()},D=g(!1),f=g("PENDIENTE"),m=g(null),l=g(0),x=g(null);I(()=>{if(i.qrData?.expiration_date){const r=new Date(i.qrData.expiration_date).getTime(),e=new Date().getTime();l.value=Math.max(0,Math.floor((r-e)/1e3))}else l.value=300;x.value=setInterval(()=>{l.value>0?l.value--:clearInterval(x.value)},1e3),q()}),j(()=>{y(),x.value&&clearInterval(x.value)});const q=()=>{m.value=setInterval(async()=>{await P()},5e3)},y=()=>{m.value&&(clearInterval(m.value),m.value=null)},P=async()=>{try{const r=await B.get(route("pagos.status",i.pago.id_pago));if(r.data.success){const e=r.data.data.estado;f.value=e,e==="PAGADO"&&(y(),setTimeout(()=>{E.visit(route("trabajos.show",i.pago.id_trabajo),{method:"get",data:{payment_success:!0}})},1500))}}catch(r){console.error("Error verificando estado:",r)}},C=r=>{const e=Math.floor(r/60),h=r%60;return`${e}:${h<10?"0":""}${h}`},b=p(()=>i.qrData?.qr_base64?`data:image/png;base64,${i.qrData.qr_base64}`:null),v=p(()=>l.value===0),d=p(()=>f.value==="PAGADO");return(r,e)=>(o(),s(M,null,[T(w(O),{title:"Pasarela de Pago"}),t("div",z,[t("div",A,[t("div",Q,[e[1]||(e[1]=t("img",{class:"mx-auto h-12 w-auto",src:"https://pagofacil.com.bo/images/logo_pagofacil.png",alt:"Pago Fácil"},null,-1)),e[2]||(e[2]=t("h2",{class:"mt-6 text-3xl font-extrabold text-gray-900"}," Escanea el QR ",-1)),t("p",S,[a.qrData?.cuota?(o(),s("span",L,[u(" Cuota "+n(a.qrData.cuota.numero_cuota)+" de "+n(a.pago.numero_cuotas)+": ",1),t("strong",$,"Bs "+n(parseFloat(a.qrData.cuota.monto).toFixed(2)),1)])):(o(),s("span",G,[e[0]||(e[0]=u(" Para completar tu pago de ",-1)),t("strong",U,"Bs "+n(parseFloat(a.pago.monto).toFixed(2)),1)]))]),a.pago.tipo_pago==="CREDITO"&&a.qrData?.cuota?(o(),s("p",H," Vence: "+n(new Date(a.qrData.cuota.fecha_vencimiento).toLocaleDateString("es-BO")),1)):c("",!0)]),d.value?(o(),s("div",J,[...e[3]||(e[3]=[t("svg",{class:"w-6 h-6 inline-block mr-2",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"})],-1),t("strong",null,"¡Pago Confirmado!",-1),u(" Redirigiendo... ",-1)])])):v.value?(o(),s("div",K,[...e[4]||(e[4]=[t("strong",null,"QR Expirado",-1),u(" - Por favor, genera un nuevo código ",-1)])])):c("",!0),t("div",W,[D.value?(o(),s("div",X,[...e[5]||(e[5]=[t("span",{class:"text-gray-500"},"Cargando QR...",-1)])])):b.value?(o(),s("div",Y,[t("img",{src:b.value,alt:"QR de Pago",class:k(["w-64 h-64 border-4 rounded-lg shadow-lg transition-all",v.value?"border-red-300 opacity-50 grayscale":"border-indigo-500"])},null,10,Z),!v.value&&!d.value?(o(),s("div",ee,[...e[6]||(e[6]=[t("span",{class:"bg-white px-3 py-1 rounded-full text-xs font-bold shadow"},"Escanear con app",-1)])])):c("",!0)])):(o(),s("div",te,[...e[7]||(e[7]=[t("span",{class:"text-gray-400"},"QR no disponible",-1)])]))]),d.value?c("",!0):(o(),s("div",ae,[t("p",{class:k(["text-sm font-medium",l.value<60?"text-red-600 animate-pulse":"text-gray-600"])},[e[8]||(e[8]=t("svg",{class:"w-4 h-4 inline-block mr-1",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z","clip-rule":"evenodd"})],-1)),u(" Tiempo restante: "+n(C(l.value)),1)],2),t("p",oe," ID: "+n(a.qrData?.transaction_id||a.pago.transaction_id||"N/A"),1)])),a.qrData?.checkout_url&&!d.value&&!v.value?(o(),s("div",se,[t("a",{href:a.qrData.checkout_url,target:"_blank",class:"text-indigo-600 hover:text-indigo-800 text-sm font-medium underline"}," O paga desde el navegador → ",8,re)])):c("",!0),t("div",ne,[a.pago.tipo_pago==="CREDITO"&&!d.value?(o(),F(w(V),{key:0,href:r.route("cuotas.index",a.pago.id_pago),class:"w-full flex justify-center py-2 px-4 border border-indigo-300 rounded-md shadow-sm text-sm font-medium text-indigo-700 bg-indigo-50 hover:bg-indigo-100 focus:outline-none transition-colors"},{default:R(()=>[...e[9]||(e[9]=[u(" Ver Plan de Cuotas ",-1)])]),_:1},8,["href"])):c("",!0),t("button",{onClick:_,type:"button",class:"w-full flex justify-center py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none transition-colors"},n(d.value?"Volver":"Cancelar"),1)]),e[10]||(e[10]=t("div",{class:"mt-4 text-center"},[t("p",{class:"text-xs text-gray-400"}," Pago seguro procesado por Pago Fácil ")],-1))])])],64))}},ce=N(le,[["__scopeId","data-v-c72c8aec"]]);export{ce as default};
